<h2><%= @event.name %></h2>

<table class="vertical_header">
  <tr>
    <th>Date</th>
    <td>
      <%= @event.date %>
    </td>
  </tr>
  
  <tr>
    <th>Deadline</th>
    <td><%= @event.deadline %></td>
  </tr>
  
  
  <tr>
    <th>Payment time</th>
    <td><%= @event.payment_time %> days</td>
  </tr>
  
</table>

<% if @event.send_mail_for?(:signup_confirmation)%>
  <%= render :partial => 'email', :locals => {
    :title => 'Signup confirmation',
    :explanation => "An e-mail will be sent out to everyone who signs up to this event. This email will look like this.",
    :template => @event.mail_templates.by_name(:signup_confirmation) } %>
<% end -%>

<% if @event.send_mail_for?(:ticket_expired) %>
  <%= render :partial => 'email', :locals => {
    :title => 'Ticket expiry',
    :explanation => "If a ticket isn't paid within #{@event.payment_time} days, it will be deleted and the following mail will be sent to the guest",
    :template => @event.mail_templates.by_name(:ticket_expired) } %>
<% end -%>

<% if @event.send_mail_for?(:payment_registered) %>
  <%= render :partial => 'email', :locals => {
    :title => 'Payment registered mail',
    :explanation => "An e-mail will be sent out to guests when their payment is registered in the economy system. This email will look like this.",
    :template => @event.mail_templates.by_name(:payment_registered) } %>
<% end -%>


<h3>Ticket types</h3>
<% if !@event.ticket_types.blank? %>
  <table class="vertical_header">
  <% for type in @event.ticket_types %>
    <tr>
      <th><%= type.name %></th>
      <td><%= type.price %> kr</td>
    </tr>
  <% end %>
  </table>
<% else %>
  
<% end %>

<h3>Guests</h3>

<% if @event.replies.empty? %>
  <p class="empty_list">No guests. You really need more PR.</p>
<% else %>
  <table border="0" id="guest_list_table">
    <tr>
      <th>Name</th>
      <th>E-mail</th>
      <th>Ticket type</th>
      <th>State</th>
      <th>Food preferences</th>
      <th>Comments</th>
    </tr>
    <% @event.replies.each do |reply| %>
    <tr>
      <td><%= reply.name %></td>
      <td><%= reply.email %></td>
      <td><%= reply.ticket_type.name %></td>
      <td>
        <% if reply.aasm_current_state == :expired %>
          Expired (No payment)
        <% elsif reply.aasm_current_state == :paid %>
          Paid (<%= reply.paid_at.strftime("%Y-%m-%d") %>)
        <% elsif reply.aasm_current_state == :new %>
          Unpaid
        <% end -%>
      <td><%= reply.food %></td>
      <td><%= reply.comments %></td>
    </tr>
    
    <% end -%>
  </table>
<% end %>

